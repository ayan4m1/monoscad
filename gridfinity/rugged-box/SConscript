Import("env")
b = ModelBuilder(env)

model = "rugged-box-gridfinity.scad"
model_dependencies = ["rugged-box-library.scad"]

gridfinity_boxes = {
    "4x2x6": [4, 2, 2, 4, False],
    "1x1x3": [1, 1, 1, 2, False],
}

for box_name, (
    width,
    length,
    top_height,
    bottom_height,
    enable_handle,
    *params,
) in gridfinity_boxes.items():
    for opts in GenerateOptions(
        part=["top", "bottom", "latch", "stacking-latch", "handle"],
        stackable=[(1, "-stackable"), (0, "")],
        base_style=[
            ("enabled", "-magnets-skeletonized"),
            ("enabled_full", "-magnets-full"),
            ("minimal", ""),
        ],
    ):
        if not enable_handle and opts.part == "handle":
            continue
        part_params = {
            **{
                "Part": opts.part,
                "Width": width,
                "Length": length,
                "Top_Height": top_height,
                "Bottom_Height": bottom_height,
                "Gridfinity_Base_Style": opts.base_style,
                "Gridfinity_Stackable": opts.stackable,
                "Top_Grip": 1,
            },
            **(params[0] if params else {}),
        }
        b.STL(
            f"gridfinity-box-{box_name}{opts.base_style_fn}{opts.stackable_fn}-{opts.part}.stl",
            model,
            part_params,
            model_dependencies,
        )

b.add_default_targets()

# vim: ft=python
